---
- name: Check Windows Event Log for Warnings and Errors
  hosts: windows
  tasks:
    - name: Get last 10 System events
      win_eventlog:
        name: System
        query: "*"
        maximum: 10
      register: events

    - name: Filter Warning and Error events
      set_fact:
        warning_error_events: "{{ events | selectattr('LevelDisplayName', 'in', ['Warning', 'Error']) | list }}"

    - name: Display Warning and Error events
      debug:
        msg: |
          {% if warning_error_events | length > 0 %}
          Found {{ warning_error_events | length }} Warning/Error events:
          {% for event in warning_error_events %}
          - Event ID: {{ event.EventID }} | Time: {{ event.TimeGenerated }} | Message: {{ event.Message }}
          {% endfor %}
          {% else %}
          No Warning/Error events found.
          {% endif %}
